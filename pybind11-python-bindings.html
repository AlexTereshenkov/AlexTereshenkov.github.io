<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Alexey Tereshenkov" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, pybind11, c++, python, " />

<meta property="og:title" content="Building Python extension modules for C++ code with pybind11 "/>
<meta property="og:url" content="/pybind11-python-bindings.html" />
<meta property="og:description" content="Introduction¶ If you ever needed to provide interface to the C/C++ code from your Python modules, you may have used Python extension modules. They are typically created when there is an existing C++ project and it is required to make it accessible via Python bindings. Alternatively, when performance becomes …" />
<meta property="og:site_name" content="Alexey Tereshenkov" />
<meta property="og:article:author" content="Alexey Tereshenkov" />
<meta property="og:article:published_time" content="2020-08-11T00:00:00+01:00" />
<meta property="og:article:modified_time" content="2020-08-11T00:00:00+01:00" />
<meta name="twitter:title" content="Building Python extension modules for C++ code with pybind11 ">
<meta name="twitter:description" content="Introduction¶ If you ever needed to provide interface to the C/C++ code from your Python modules, you may have used Python extension modules. They are typically created when there is an existing C++ project and it is required to make it accessible via Python bindings. Alternatively, when performance becomes …">

        <title>Building Python extension modules for C++ code with pybind11  · Alexey Tereshenkov
</title>
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Alexey Tereshenkov - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-177875539-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/"><span class=site-name>Alexey Tereshenkov</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       "/"
                                    >Home</a>
                                </li>
                                <li ><a href="/categories.html">Categories</a></li>
                                <li ><a href="/tags.html">Tags</a></li>
                                <li ><a href="/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="/pybind11-python-bindings.html">
                Building Python extension modules for C++ code with pybind11
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#python-bindings">Python bindings</a></li>
<li><a href="#writing-c-code">Writing C++ code</a></li>
<li><a href="#building-a-python-extension-module">Building a Python extension module</a></li>
<li><a href="#using-a-python-extension-module">Using a Python extension module</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h3 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h3>
<p>If you ever needed to provide interface to the C/C++ code from your Python modules,
you may have used <a href="https://docs.python.org/3/extending/extending.html">Python extension modules</a>.
They are typically created when there is an existing C++ project and it is required to make it
accessible via Python bindings.
Alternatively, when performance becomes critical, a certain part of the Python project can be written
in C/C++ and made accessible to the rest of the Python codebase via some kind of interface.</p>
<p>Quite a few large C++ libraries and frameworks have associated Python bindings – they can be used
for prototyping or simply to speed up the development as writing a Python program is supposed to take
less time than writing an equivalent C++ program.
Exposing your library interface with another popular language, such as Python, will also make your project
more accessible for programmers who are not very familiar with C++.</p>
<p>Refer to excellent <a href="https://realpython.com/python-bindings-overview/">RealPython: Python Bindings: Calling C or C++ From Python</a>
article to learn more.</p>
<h3 id="python-bindings">Python bindings<a class="headerlink" href="#python-bindings" title="Permanent link">¶</a></h3>
<p>There are quite a few options on how you can make your C++ code accessible from Python.
However, I have personally worked only with <code>SWIG</code> and <code>pybind11</code> so far.
For now, let’s focus on <a href="https://github.com/pybind/pybind11/blob/master/docs/basics.rst"><code>pybind11</code></a>.
It’s extremely easy to set up on Linux or Windows and you should be able to create a compiled Python
extension module (<code>.so</code> for Linux and <code>.pyd</code> for Windows) very quickly.</p>
<p>The <a href="https://pybind11.readthedocs.io/en/stable/basics.html">pybind11 documentation</a> does provide excellent reference
information with a ton of examples.
However, those examples often demonstrate features in isolation 
and I thought it would be useful to share an example of a
more complete “library” where multiple examples are combined into something that looks like a MVP.</p>
<h3 id="writing-c-code">Writing C++ code<a class="headerlink" href="#writing-c-code" title="Permanent link">¶</a></h3>
<p>Here is the C++ file, <code>Geometry.cpp</code>, I’ve written to demonstrate the <code>pybind11</code> features.
It showcases constructing custom <code>Point</code> class instances, finding the distance between them in 2D and 3D space, 
and overloading C++ comparison operators among a few other things.</p>
<figure class="code">
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;pybind11/pybind11.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;pybind11/operators.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">py</span> <span class="o">=</span> <span class="n">pybind11</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Point</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Point</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">quiet_NaN</span><span class="p">();</span>
        <span class="n">py</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">"Constructing a point with z set to nan"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Point</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="n">z</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">z</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">py</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">"Constructing a point with z set to a user given value"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">z</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">shapeType</span> <span class="o">=</span> <span class="s">"Point"</span><span class="p">;</span>

    <span class="kt">double</span> <span class="nf">distanceTo</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">in3D</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in3D</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">pow</span><span class="p">((</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">pow</span><span class="p">((</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">pow</span><span class="p">((</span><span class="n">point</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">py</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">"Cannot measure distance between points in XY and XYZ space"</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">quiet_NaN</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span>
                <span class="n">pow</span><span class="p">((</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">pow</span><span class="p">((</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="k">static</span> <span class="nf">areEqual</span><span class="p">(</span><span class="n">Point</span> <span class="n">left</span><span class="p">,</span> <span class="n">Point</span> <span class="n">right</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isnan</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">z</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">left</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">right</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">left</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">right</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="o">^</span> <span class="n">isnan</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">z</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">left</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">right</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">left</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">right</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">left</span><span class="p">.</span><span class="n">z</span> <span class="o">==</span> <span class="n">right</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">areEqual</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">areEqual</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">is3D</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">PYBIND11_MODULE</span><span class="p">(</span><span class="n">Geometry</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m</span><span class="p">.</span><span class="n">doc</span><span class="p">()</span> <span class="o">=</span> <span class="s">"C++ toy geometry library"</span><span class="p">;</span>

    <span class="n">py</span><span class="o">::</span><span class="n">class_</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">"Point"</span><span class="p">,</span> <span class="s">"Point shape class implementation"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">init</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;&gt;</span><span class="p">(),</span>
            <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"x"</span><span class="p">),</span> <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"y"</span><span class="p">))</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">init</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="o">&amp;&gt;</span><span class="p">(),</span>
            <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"x"</span><span class="p">),</span> <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"y"</span><span class="p">),</span> <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"z"</span><span class="p">))</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"x"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">x</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"y"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">y</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"z"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">z</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"shapeType"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">shapeType</span><span class="p">)</span>

        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"distanceTo"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">distanceTo</span><span class="p">,</span>
            <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"point"</span><span class="p">),</span> <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"in3D"</span><span class="p">)</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
            <span class="s">"Distance to another point"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"is3D"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">is3D</span><span class="p">,</span> <span class="s">"Whether a point has a valid z coordinate"</span><span class="p">)</span>

        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">self</span> <span class="o">==</span> <span class="n">py</span><span class="o">::</span><span class="n">self</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">self</span> <span class="o">!=</span> <span class="n">py</span><span class="o">::</span><span class="n">self</span><span class="p">)</span>

        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"__repr__"</span><span class="p">,</span>
            <span class="p">[](</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">point</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">stringstream</span> <span class="n">xAsString</span><span class="p">,</span> <span class="n">yAsString</span><span class="p">,</span> <span class="n">zAsString</span><span class="p">;</span>
                <span class="n">xAsString</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
                <span class="n">yAsString</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
                <span class="n">zAsString</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">z</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="s">"Point ("</span> <span class="o">+</span> <span class="n">xAsString</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">yAsString</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">+</span>
                        <span class="s">", "</span> <span class="o">+</span> <span class="n">zAsString</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="s">"Point ("</span> <span class="o">+</span> <span class="n">xAsString</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">yAsString</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
</figure>
<h3 id="building-a-python-extension-module">Building a Python extension module<a class="headerlink" href="#building-a-python-extension-module" title="Permanent link">¶</a></h3>
<p>Once you have the <code>Geometry.cpp</code> file on disk and <code>pybind11</code> installed, you should be able to compile the C++ code
and link it to the Python headers:</p>
<div class="highlight"><pre><span></span><code>$ c++ -O3 -Wall -shared -std<span class="o">=</span>c++11 -fPIC <span class="sb">`</span>python3 -m pybind11 --includes<span class="sb">`</span> Geometry.cpp -o Geometry<span class="sb">`</span>python3-config --extension-suffix<span class="sb">`</span>
</code></pre></div>
<p>If you are not very familiar with Bash, command in the backticks in the command above are evaluated by the shell before the main command. </p>
<p>The <code>python3 -m pybind11 --includes</code> part is used to get the location of Python header files 
and the <code>python3-config --extension-suffix</code> part is used to get the suffix for the shared library name –
for CPython 3.6 on a 64bit Ubuntu, the <code>Geometry.cpython-36m-x86_64-linux-gnu.so</code> file will be created.</p>
<p>Now, once you have the shared library file, it can be imported and used pretty much as if it was a regular
Python module. </p>
<h3 id="using-a-python-extension-module">Using a Python extension module<a class="headerlink" href="#using-a-python-extension-module" title="Permanent link">¶</a></h3>
<p>Let’s see our library in action by running the file <code>python3 use_geometry.py</code> containing the code below:</p>
<figure class="code">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">Geometry</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="c1"># runtime dispatch of init constructors</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Point</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="c1"># a method signature and its docstring</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Point</span><span class="o">.</span><span class="n">distanceTo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">45.67</span><span class="p">)</span>
<span class="n">p5</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">45.67</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p1</span><span class="o">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># check operator overloading works</span>
<span class="k">assert</span> <span class="n">p1</span> <span class="o">!=</span> <span class="n">p2</span>
<span class="k">assert</span> <span class="n">p2</span> <span class="o">==</span> <span class="n">p3</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p2</span> <span class="o">!=</span> <span class="n">p3</span>
<span class="k">assert</span> <span class="n">p4</span> <span class="o">==</span> <span class="n">p5</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p4</span> <span class="o">==</span> <span class="n">p3</span>

<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># check distance between 3D points</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">in3D</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># check __repr__</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
</code></pre></div>
</figure>
<p>The produced output:</p>
<div class="highlight"><pre><span></span><code>__init__(*args, **kwargs)
Overloaded function.
1. __init__(self: Geometry.Point, x: float, y: float) -&gt; None
2. __init__(self: Geometry.Point, x: float, y: float, z: float) -&gt; None

distanceTo(self: Geometry.Point, point: Geometry.Point, in3D: bool = False) -&gt; float
Distance to another point

Constructing a point with z set to nan
Constructing a point with z set to nan
Constructing a point with z set to nan
Constructing a point with z set to a user given value
Constructing a point with z set to a user given value
Constructing a point with z set to a user given value
Constructing a point with z set to a user given value
Distance between Point (50, 60, 45) and Point (50, 60, 75) is 30.0
Representation of the p1 is "Point (50, 60, 45)"
Representation of the p2 is "Point (50, 60, 75)"
</code></pre></div>
<p>This is of course a very trivial example of <code>pybind11</code> usage, however there have been
successful attempts to use <code>pybind11</code> for binding existing large C++ libraries 
such as <a href="https://www.cgal.org/">CGAL</a> and <a href="https://pcl.readthedocs.io/projects/tutorials/en/latest/#">Point Cloud Library</a>.
See an example of <a href="https://github.com/rob-smallshire/mesher">wrapping some of the CGAL functionality with pybind11</a>
and <a href="https://github.com/davidcaron/pclpy">Python bindings for the Point Cloud Library</a> to learn more.</p>
<p>Happy binding!</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-08-11T00:00:00+01:00">Tue 11 August 2020</time>

            <h4>Category</h4>
            <a class="category-link" href="/categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#c-ref">c++
                    <span class="superscript">1</span>
</a></li>
                <li><a href="/tags.html#pybind11-ref">pybind11
                    <span class="superscript">1</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span class="superscript">21</span>
</a></li>
            </ul>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>