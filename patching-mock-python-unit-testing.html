<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Alexey Tereshenkov" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, mock, testing, patch, python, " />

<meta property="og:title" content="Patching with unittest.mock for Python testing: cheat sheet "/>
<meta property="og:url" content="/patching-mock-python-unit-testing.html" />
<meta property="og:description" content="Overview of patching¶ Python built-in unittest framework provides the mock module which gets very handy when writing unit tests. It also provides the patch entity which can be used as a function decorator, class decorator or a context manager. The basic idea behind patching is that it lets you temporarily …" />
<meta property="og:site_name" content="Alexey Tereshenkov" />
<meta property="og:article:author" content="Alexey Tereshenkov" />
<meta property="og:article:published_time" content="2020-11-20T00:00:00+00:00" />
<meta property="og:article:modified_time" content="2021-09-29T00:00:00+01:00" />
<meta name="twitter:title" content="Patching with unittest.mock for Python testing: cheat sheet ">
<meta name="twitter:description" content="Overview of patching¶ Python built-in unittest framework provides the mock module which gets very handy when writing unit tests. It also provides the patch entity which can be used as a function decorator, class decorator or a context manager. The basic idea behind patching is that it lets you temporarily …">

        <title>Patching with unittest.mock for Python testing: cheat sheet  · Alexey Tereshenkov
</title>
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Alexey Tereshenkov - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-177875539-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/"><span class=site-name>Alexey Tereshenkov</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       "/"
                                    >Home</a>
                                </li>
                                <li ><a href="/categories.html">Categories</a></li>
                                <li ><a href="/tags.html">Tags</a></li>
                                <li ><a href="/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="/patching-mock-python-unit-testing.html">
                Patching with unittest.mock for Python testing: cheat sheet
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#overview-of-patching">Overview of patching</a></li>
<li><a href="#patching-class-initialization">Patching class initialization</a></li>
<li><a href="#patching-static-class-and-instance-methods">Patching static, class, and instance methods</a></li>
<li><a href="#patching-a-class-instance-attribute">Patching a class instance attribute</a></li>
<li><a href="#patching-a-nested-class-instance-attribute">Patching a nested class instance attribute</a></li>
<li><a href="#patching-class-instance-method-that-modifies-self">Patching class instance method that modifies self</a></li>
<li><a href="#patching-multiple-calls-to-the-same-function">Patching multiple calls to the same function</a></li>
<li><a href="#patching-function-and-its-returned-object">Patching function and its returned object</a></li>
<li><a href="#patching-class-properties">Patching class properties</a></li>
<li><a href="#patching-opening-a-file-with-open">Patching opening a file with open</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h3 id="overview-of-patching">Overview of patching<a class="headerlink" href="#overview-of-patching" title="Permanent link">¶</a></h3>
<p>Python built-in <code>unittest</code> framework provides the 
<a href="https://docs.python.org/3/library/unittest.mock.html"><code>mock</code></a> module 
which gets very handy when writing unit tests.
It also provides the <a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.patch"><code>patch</code></a>
entity which can be used as a function decorator, class decorator or a context manager.</p>
<p>The basic idea behind patching is that it lets you temporarily change the object that is being used when your test runs.
For example, if you are testing a function that needs to read some data out
of a database, you can patch it so that you don’t need to 
communicate with any external services when unit tests run.</p>
<p>Given this piece of code, we are interested in testing the <code>get_customers()</code> function.
We have tests in place for functions (<code>validate_input</code> and <code>fetch</code>) that this function calls,
so that we can ignore them.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_customers</span><span class="p">(</span><span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">validate_input</span><span class="p">(</span><span class="n">object_type</span><span class="o">=</span><span class="n">CITY</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">city</span><span class="p">)</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s1">'customers;city=</span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">customers</span>
</code></pre></div>
<p>To patch those functions, instead of calling them at the execution time, 
anonymous lambda functions could be used.
For the <code>validate_input()</code> function, we are not interested in the return value; however, for the
<code>fetch</code> function we are.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_customers</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">'utils.validate_input'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">object_type</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_customers</span><span class="p">():</span>
    <span class="n">expected_customers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Customer1'</span><span class="p">,</span> <span class="s1">'Customer2'</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'utils.fetch'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">query</span><span class="p">:</span> <span class="n">expected_customers</span><span class="p">):</span>
        <span class="n">actual_customers</span> <span class="o">=</span> <span class="n">get_customers</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s1">'Paris'</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">actual_customers</span> <span class="o">==</span> <span class="n">expected_customers</span>
</code></pre></div>
<p>The patched <code>fetch</code> function doesn’t have to return any meaningful value as we will only be testing
whether it returned what the patching function is supposed to return.
However, I often find it to be easier to understand the context and business logic when
some more real values are used.
Note that the <code>patch()</code> was used both as a context manager and as a test function decorator.</p>
<p>In the rest of the post, we will explore typical use cases for patching and mocking.</p>
<h2 id="patching-class-initialization">Patching class initialization<a class="headerlink" href="#patching-class-initialization" title="Permanent link">¶</a></h2>
<p>Use case: </p>
<p>You want to test a class method, but initializing a class instance would
require a lot of additional mocking to pass valid input parameters. 
You also want to avoid any real initialization operations, but would still
want to have some of the class instance variables set.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FileProcessor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span> <span class="n">process_config</span><span class="p">:</span> <span class="n">ProcessorConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="n">process_config</span>

    <span class="k">def</span> <span class="nf">validate_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># operate on the files and return some validation result</span>
        <span class="o">...</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_validate_files</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">FileProcessor</span><span class="p">,</span> <span class="s1">'__init__'</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">FileProcessor</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">fp</span><span class="o">.</span><span class="n">validate_files</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"status"</span><span class="p">)</span> <span class="o">==</span> <span class="n">ValidationStatus</span><span class="o">.</span><span class="n">SUCCESS</span>

        <span class="n">fp</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">fp</span><span class="o">.</span><span class="n">validate_files</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"status"</span><span class="p">)</span> <span class="o">==</span> <span class="n">ValidationStatus</span><span class="o">.</span><span class="n">FAILURE</span>
</code></pre></div>
<h2 id="patching-static-class-and-instance-methods">Patching static, class, and instance methods<a class="headerlink" href="#patching-static-class-and-instance-methods" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a class for which you want to patch some of the class instance methods,
class methods, or static methods.
You would need to patch a method of interest and the process of patching the methods 
is universal for all the methods types.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Address</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">house</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">street</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="n">numerize</span><span class="p">(</span><span class="n">house</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">street</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postal_code</span> <span class="o">=</span> <span class="n">postal_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tuple</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">address_tuple</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Address</span><span class="p">(</span><span class="o">*</span><span class="n">address_tuple</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">numerize</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">house</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">postal_code</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">"</span>

    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span>

<span class="k">def</span> <span class="nf">is_valid_address</span><span class="p">(</span><span class="n">address_tuple</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Address</span><span class="o">.</span><span class="n">from_tuple</span><span class="p">(</span><span class="o">*</span><span class="n">address_tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_is_valid_address</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'static_class.Address.from_tuple'</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">data</span><span class="p">:</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">is_valid_address</span><span class="p">((</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"New Road"</span><span class="p">,</span> <span class="s2">"99999"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'static_class.Address.from_tuple'</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="ne">Exception</span><span class="p">()):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_address</span><span class="p">((</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"New Road"</span><span class="p">,</span> <span class="s2">"99999"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">test_address_construct</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'static_class.Address.numerize'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="mi">9999</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"New Road"</span><span class="p">,</span> <span class="s2">"99999"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">address</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="s2">"City"</span>
        <span class="k">assert</span> <span class="n">address</span><span class="o">.</span><span class="n">house</span> <span class="o">==</span> <span class="mi">9999</span>

<span class="k">def</span> <span class="nf">test_print</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'static_class.Address.to_string'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="s2">"Address formatted"</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"New Road"</span><span class="p">,</span> <span class="s2">"99999"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">address</span><span class="o">.</span><span class="n">print</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"Address formatted"</span>
</code></pre></div>
<h2 id="patching-a-class-instance-attribute">Patching a class instance attribute<a class="headerlink" href="#patching-a-class-instance-attribute" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a class that when instantiated has an attribute.
You are interested in patching this attribute to be set to some value.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># country:capital mapping</span>
<span class="n">countries_capitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"France"</span><span class="p">:</span> <span class="s2">"Paris"</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">City</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">get_capital</span><span class="p">(</span><span class="n">country</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">get_city</span><span class="p">(</span><span class="n">countries_capitals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">country</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">city</span><span class="o">.</span><span class="n">name</span>


<span class="k">def</span> <span class="nf">get_city</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">City</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
<p>Test:</p>
<p>We want to patch the <code>get_city()</code> function when testing the <code>get_capital()</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">class_instance_fields</span> <span class="kn">import</span> <span class="n">get_capital</span>


<span class="k">def</span> <span class="nf">test_get_capital</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'class_instance_fields.get_city'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
        <span class="n">mock</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Capital"</span>
        <span class="k">assert</span> <span class="n">get_capital</span><span class="p">(</span><span class="s2">"Country"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"Capital"</span>
</code></pre></div>
<h2 id="patching-a-nested-class-instance-attribute">Patching a nested class instance attribute<a class="headerlink" href="#patching-a-nested-class-instance-attribute" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a class that when instantiated has an attribute that itself is
an instance of a class with additional instance attributes.
You are interested in patching this nested attribute to be set to some
value.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">class</span> <span class="nc">City</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">Address</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">City</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">address</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
</code></pre></div>
<p>Test:</p>
<p>We want to patch the <code>get_address()</code> method on the class instance 
and then set a returned object to have a nested attribute set to some value.
This may be necessary when you are trying to cover a code branch which
will be executed only when a value of the nested attribute is equal to a certain value.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">MagicMock</span>

<span class="k">def</span> <span class="nf">test_customer_address</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'customer.Customer'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_customer</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">mock_customer</span><span class="o">.</span><span class="n">return_value</span>
        <span class="n">mock_address</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="c1"># MagicMock lets you define nested attributes</span>
        <span class="n">mock_address</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"BigCity"</span>
        <span class="n">c</span><span class="o">.</span><span class="n">get_address</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_address</span>
        <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">get_address</span><span class="p">()</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'BigCity'</span>
</code></pre></div>
<h2 id="patching-class-instance-method-that-modifies-self">Patching class instance method that modifies <code>self</code><a class="headerlink" href="#patching-class-instance-method-that-modifies-self" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a method which doesn’t return anything but instead sets 
or modifies its object (<code>self</code>) properties.
You cannot patch the mock’s method with <code>.return_value</code> 
and thus need instead modify the values of the <code>self</code>.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Client</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">guid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time_visited</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time_visited</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">()</span>
</code></pre></div>
<p>Test:</p>
<p>We would like to test the <code>process()</code> method without letting it to execute the <code>visit()</code> method,
but still check that after running the <code>process()</code> method, the <code>Client</code> instance would get
certain fields set.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">client</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="k">def</span> <span class="nf">setattrs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_process</span><span class="p">():</span>
    <span class="n">mock_client</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'client.Client'</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">mock_client</span><span class="p">):</span>
        <span class="n">mock_client</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">setattrs</span><span class="p">(</span><span class="n">mock_client</span><span class="p">,</span>
            <span class="n">visited</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">last_time_visited</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">visited</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">last_time_visited</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)</span>
</code></pre></div>
<h2 id="patching-multiple-calls-to-the-same-function">Patching multiple calls to the same function<a class="headerlink" href="#patching-multiple-calls-to-the-same-function" title="Permanent link">¶</a></h2>
<p>Use case: </p>
<p>You call a function being mocked multiple times in the source code being tested 
and need to return a different value for each call.
For instance, you mock a function call that will check whether 
a database table exists, then you call a function to delete it, 
and then use the first function again to make sure 
that the table does not exist (i.e., it was successfully deleted).</p>
<p>You cannot simply mock the function with the <code>patch</code> because it will
then return the same value.
You have to use the <code>Mock().side_effect</code> property.
The <code>side_effect</code> collection can even have an exception initialization
if at a certain time you call the mocked function a particular exception is
expected to be raised: <code>side_effect = [10, 15, ValueError()]</code>.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">delete_table</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">delete_db_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
        <span class="n">delete_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to delete table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@patch</span><span class="p">(</span><span class="s1">'db.delete_table'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_delete_db_table</span><span class="p">():</span>    
    <span class="n">get_table_mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

    <span class="c1"># db table gets deleted</span>
    <span class="n">get_table_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'db.get_table'</span><span class="p">,</span> <span class="n">get_table_mock</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">delete_db_table</span><span class="p">(</span><span class="s2">"LogHistory"</span><span class="p">)</span>

    <span class="c1"># db table fails to be deleted</span>
    <span class="n">get_table_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'db.get_table'</span><span class="p">,</span> <span class="n">get_table_mock</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">delete_db_table</span><span class="p">(</span><span class="s2">"LogHistory"</span><span class="p">)</span>
</code></pre></div>
<h2 id="patching-function-and-its-returned-object">Patching function and its returned object<a class="headerlink" href="#patching-function-and-its-returned-object" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>When you patch a function or a method, it may be the case that the object
that it will return may have own methods that you would want to patch.
For instance, when patching <code>subprocess.run()</code> that returns a <code>CompletedProcess</code> object,
you may want to patch its <code>.check_returncode()</code> method to return some value.
Just as with the <code>Mock().side_effect()</code>, it’s possible to create side effects for methods
of a <code>Mock()</code> object.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">check_returncode</span><span class="p">()</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_call_cmd</span><span class="p">():</span>
    <span class="n">run_mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">run_mock</span><span class="o">.</span><span class="n">check_returncode</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s2">"0"</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'subprocess_run.subprocess.run'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">run_mock</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">call_cmd</span><span class="p">(</span><span class="s1">'du -sh lib'</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"0"</span>

    <span class="n">run_mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">run_mock</span><span class="o">.</span><span class="n">check_returncode</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'subprocess_run.subprocess.run'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">run_mock</span><span class="p">):</span>        
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">CalledProcessError</span><span class="p">):</span>
            <span class="n">call_cmd</span><span class="p">(</span><span class="s1">'du -sh non-existing-dir'</span><span class="p">)</span>
</code></pre></div>
<h2 id="patching-class-properties">Patching class properties<a class="headerlink" href="#patching-class-properties" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a class with one or more properties decorated with the <code>@property</code>.
Mocking them requires special handling using the <code>unittest.mock.PropertyMock</code> object.
This is useful when the initialization of an object’s property is complex
and is not really required for a particular unit test.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Process</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pid</span> <span class="o">=</span> <span class="n">pid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid</span>

    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">'Process(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s1">)'</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_process_pid_property</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Process</span><span class="p">,</span> <span class="s1">'__init__'</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'class_properties.Process.pid'</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">PropertyMock</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_pid</span><span class="p">:</span>
            <span class="n">mock_pid</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">99</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'Process(99)'</span>
</code></pre></div>
<h2 id="patching-opening-a-file-with-open">Patching opening a file with <code>open</code><a class="headerlink" href="#patching-opening-a-file-with-open" title="Permanent link">¶</a></h2>
<p>Use case:</p>
<p>You have a function that is interacting with the file system by opening a file.
A helper function <code>unittest.mock.mock_open</code> can be used to replace the use of <code>open</code>.</p>
<p>Code:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_read_file</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'read_file.open'</span><span class="p">,</span> <span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="s2">"lines"</span><span class="p">)):</span>
        <span class="k">assert</span> <span class="n">read</span><span class="p">(</span><span class="s1">'dir/path'</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"lines"</span><span class="p">]</span>
</code></pre></div>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>When mocking is required for too many places, it may be the case that your class or a function
is too big and would be a good candidate for refactoring.
To make mocking for a large (or complex) code unit easier, you can use 
<a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.MagicMock"><code>unittest.mock.MagicMock()</code></a>
instead.</p>
</li>
<li>
<p>When patching code that is interacting with the file system too often,
patching all the <code>os</code>, <code>pathlib</code>, and <code>shutil</code> things can get tedious rather quickly.
You may want to take a look at the virtual file system, <a href="http://jmcgeheeiv.github.io/pyfakefs/release/">pyfakefs</a>, to be used when testing.
Keep in mind that you won’t be able to use <code>mock.patch</code> to patch your file system 
interaction functions when you use <code>pyfakefs</code> because it patches them on its own.</p>
</li>
<li>
<p>When your programs are really scripts that process some files, you may be better off
writing good integration tests using real data instead.
This could be particularly true when your Python program is relying on using non-Python 
code such as compiled C (for which you have no source code) to read/process/write data.
In this situation, you won’t be able to use the <code>pyfakefs</code> virtual file system and mocking
all the interaction between your Python programs and external tools can be tedious.</p>
</li>
<li>
<p>If the programs for which you write unit tests interact with external web services 
over HTTP a lot, you may look into the <a href="https://github.com/kevin1024/vcrpy"><code>vcrpy</code></a> 
package that can automatically mock your HTTP interactions.
The <a href="https://github.com/kiwicom/pytest-recording"><code>pytest-recording</code></a> 
plugin provides handy custom markers.</p>
</li>
</ol>
<p>Happy patching!                </p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-11-20T00:00:00+00:00">Fri 20 November 2020</time>
<h4>Last Updated</h4>
<time datetime="2021-09-29T00:00:00+01:00">Sep 29, 2021</time>

            <h4>Category</h4>
            <a class="category-link" href="/categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#mock-ref">mock
                    <span class="superscript">1</span>
</a></li>
                <li><a href="/tags.html#patch-ref">patch
                    <span class="superscript">1</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span class="superscript">21</span>
</a></li>
                <li><a href="/tags.html#testing-ref">testing
                    <span class="superscript">5</span>
</a></li>
            </ul>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>